import 'dart:async';

/// ุณุฑูุณ ุณุงุฏู ุจุฑุง ุงุฑุชุจุงุท ุจุง ูพุดุชุจุงู ููุด ูุตููุน.
///
/// ุฏุฑ ุญุงู ุญุงุถุฑ ุงู ุณุฑูุณ ูพุงุณุฎโูุง ุฑุง ุจู ุตูุฑุช ุณุงุฎุชฺฏ ุชููุฏ ูโฺฉูุฏ
/// ุชุง ุชุฌุฑุจู ฺฉุงุฑุจุฑ ุตูุญู ฺุช ูุงุจู ุชุณุช ุจุงุดุฏ. ุฏุฑ ุขูุฏู ูโุชูุงู
/// ููู ฺฉูุงุณ ุฑุง ุจู ฺฉ API ูุงูุน ูุชุตู ฺฉุฑุฏ.
class AiSupportService {
  AiSupportService._();

  static final AiSupportService _instance = AiSupportService._();

  factory AiSupportService() => _instance;

  /// ุชุงุฎุฑ ุณุงุฎุชฺฏ ุจุฑุง ุดุจูโุณุงุฒ ุฒูุงู ูพุงุณุฎโฺฏู ุณุฑูุฑ
  static const Duration simulatedLatency = Duration(milliseconds: 900);
  static const String _followUpNote =
      'ุงฺฏุฑ ุจุง ุงู ูพุงุณุฎ ูุงูุน ูุดุฏ ูโุชูู ุณูุงู ุฎูุฏุช ุฑู ุฏููโุชุฑ ุจูพุฑุณ ุชุง ููุด ูุตููุน ุฑุงูููุง ฺฉูู ุง ุงุฒ ุทุฑู ุจุฎุด ยซูพุดููุงุฏุงุช ู ุงูุชูุงุฏุงุชยป ุจุง ูพุดุชุจุงู ุฏุฑ ุงุฑุชุจุงุท ุจุงุด.';

  /// ุงุฑุณุงู ูพุงู ฺฉุงุฑุจุฑ ู ุฏุฑุงูุช ูพุงุณุฎ ูุฏู
  Future<String> sendMessage(String prompt) async {
    await Future.delayed(simulatedLatency);

    final normalized = prompt.trim().toLowerCase();

    if (normalized.isEmpty) {
      return _withFollowUp(
        'ุจุฑุง ุงูฺฉู ุทุจู ุฑููโูุง ุจุฑูุงูู ุฏูู ุฑุงูููุงุช ฺฉููุ ูุทูุงู ุชูุถุญ ุจุดุชุฑ ุฏุฑุจุงุฑู ููุถูุน ุณุคุงูุช ุจููุณ.',
      );
    }

    if (_containsAny(normalized, ['ุซุจุช ูุงู', 'ูุฑูุฏ', 'otp', 'ฺฉุฏ ุชุงุฏ'])) {
      return _withFollowUp(
        'ุทุจู ุฑูู ูุฑูุฏุ ุจุนุฏ ุงุฒ ูุงุฑุฏ ฺฉุฑุฏู ุดูุงุฑู ููุจุงูุ ฺฉุฏ ุชุงุฏ ุจู ููุงู ุดูุงุฑู ูพุงูฺฉ ูโุดูุฏ. ฺฉุฏ ุฑุง ุญุฏุงฺฉุซุฑ ุธุฑู ถฐ ุซุงูู ุฏุฑ ุตูุญู ุจุนุฏ ูุงุฑุฏ ฺฉูุ ุงฺฏุฑ ูุฑุณุฏ ุฏฺฉูู ุงุฑุณุงู ูุฌุฏุฏ ุฑุง ุจุฒู ู ูุทูุฆู ุดู ููุชุฑ ูพุงูฺฉ ุชุจูุบุงุช ุฎุงููุด ุงุณุช.',
      );
    }

    if (_containsAny(normalized, ['ุฏูุฑู', 'ฺฉูุงุณ', 'ูุณุฑ', 'ุจุฑูุงูู ุขููุฒุด'])) {
      return _withFollowUp(
        'ุจุฑุง ูุดุงูุฏู ฺฉูุงุณโูุง ูุงุฑุฏ ููู ยซูุณุฑ ุฏูุฑูยป ุดู. ุฏูุฑูโูุง ูุนุงู ุจุง ุจุฑฺุณุจ ูุถุนุช ูุดุฎุต ุดุฏูโุงูุฏ ู ูโุชูุงู ุงุฒ ููุงูโุฌุง ูุญุชูุง ู ุฌูุณุงุช ุขูุฏู ุฑุง ุจุจู. ุงฺฏุฑ ุฏูุฑูโุง ูุนุงู ูุดุฏ ฺฉุจุงุฑ ุฎุฑูุฌ ุงูู ุงูุฌุงู ุจุฏู ู ุฏูุจุงุฑู ูุงุฑุฏ ุดู.',
      );
    }

    if (_containsAny(normalized, ['ุขุฒููู', 'ูพุดุฑูุช', 'ูุชุฌู', 'ุงุฑุฒุงุจ'])) {
      return _withFollowUp(
        'ฺฏุฒุงุฑุด ูพุดุฑูุช ู ูุชุงุฌ ุขุฒูููโูุง ุฏุงุฎู ุฏุงุดุจูุฑุฏ ูุณุฑ ุฏูุฑู ุซุจุช ูโุดูุฏ. ูุฑ ุขุฒููู ุจุนุฏ ุงุฒ ุชุตุญุญ ุจุง ุฏุฑุตุฏ ู ุชูุถุญ ุฏุฑ ููุงู ฺฉุงุฑุช ููุงุด ุฏุงุฏู ูโุดูุฏ ู ูโุชูุงู ูุงู ฺฏุฒุงุฑุด ุฑุง ุฏุงูููุฏ ฺฉู.',
      );
    }

    if (_containsAny(normalized, ['ฺฉุงุฑุช', 'ุดูุงุณุง', 'id', 'ฺฉุงุฑุช ุดุฑฺฉุช ฺฉููุฏู'])) {
      return _withFollowUp(
        'ฺฉุงุฑุช ุดูุงุณุง ุฏุฌุชุงู ุงุฒ ูุณุฑ ยซฺฉุงุฑุช ุดุฑฺฉุชโฺฉููุฏูยป ุฏุฑ ููู ุงุตู ูุนุงู ูโุดูุฏ. ุงุจุชุฏุง ุงุทูุงุนุงุช ูพุฑููุงู ุฑุง ฺฉุงูู ฺฉู ู ุณูพุณ QR ฺฉุงุฑุช ุฑุง ุฏุฑุงูุช ุง ุฏุงูููุฏ ฺฉู.',
      );
    }

    if (_containsAny(normalized, ['ูพุฑููุงู', 'ุฑุฒููู', 'ุงุทูุงุนุงุช ฺฉุงุฑุจุฑ'])) {
      return _withFollowUp(
        'ุฏุฑ ุตูุญู ูพุฑููุงู ูโุชูุงู ูุดุฎุตุงุช ูุฑุฏุ ุณูุงุจูุ ููุงุฑุชโูุง ู ูุฏุงุฑฺฉ ุฑุง ูุฑุงุด ฺฉู. ูุฑ ุชุบุฑ ุจุนุฏ ุงุฒ ุฐุฎุฑูโุณุงุฒ ุฏุฑ ุฏุงุดุจูุฑุฏ ุงุฑุฒุงุจ ูู ูุญุงุธ ูโุดูุฏ.',
      );
    }

    if (_containsAny(normalized, ['ฺฏุงูุฑ', 'ูุญุชูุง', 'ูุฏุฆู', 'ุชุตูุฑ'])) {
      return _withFollowUp(
        'ุจุฑุง ุฏุณุชุฑุณ ุจู ูุฏุฆููุงุ ูพุงุฏฺฉุณุชโูุง ู ุชุตุงูุฑ ุขููุฒุด ูุงุฑุฏ ุจุฎุด ยซฺฏุงูุฑยป ุดู. ูโุชูุงู ููุชุฑ ุฏุณุชูโุจูุฏ ุฑุง ูุนุงู ฺฉู ุชุง ุณุฑุนโุชุฑ ุจู ูุญุชูุง ููุฑุฏูุธุฑุช ุจุฑุณ.',
      );
    }

    if (_containsAny(normalized, ['ูพุดุชุจุงู', 'ุงุฑุชุจุงุท', 'ุชูุงุณ', 'ฺฉูฺฉ'])) {
      return _withFollowUp(
        'ููุงุฑ ููุดููุฏ ูููโุฌุง ููุฑุงู ุชูุณุช ๐ ุฏุฑ ุตูุฑุช ูุงุฒ ุจู ุชูุงุณ ุงูุณุงูุ ุงุฒ ุดูุจู ุชุง ฺูุงุฑุดูุจู ุณุงุนุช น ุชุง ฑธ ุจุง ุดูุงุฑู ฐฒฑ-ฑฒณดตถทธ ุฏุงุฎู ณ ุงุฑุชุจุงุท ุจฺฏุฑ.',
      );
    }

    return _withFollowUp(
      'ูพุงูุช ุฑุง ุฏุฑุงูุช ฺฉุฑุฏู ู ุทุจู ุฑููโูุง ุจุฑูุงูู ุฏุฑ ุญุงู ุจุฑุฑุณโุงุด ูุณุชู. ุงฺฏุฑ ุฌุฒุฆุงุช ุจุดุชุฑ ุจุฏู ูโุชูุงูู ุฏููโุชุฑ ฺฉูฺฉ ฺฉูู.',
    );
  }

  bool _containsAny(String input, List<String> keywords) {
    return keywords.any((keyword) => input.contains(keyword));
  }

  String _withFollowUp(String mainResponse) {
    return '$mainResponse\n\n$_followUpNote';
  }
}
